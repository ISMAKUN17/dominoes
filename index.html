<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservas de Restaurantes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --accent: #f59e42;
            --success: #22c55e;
            --danger: #ef4444;
            --bg: #f7f9fb;
            --bg-card: #fff;
            --text: #222;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 2px 16px rgba(30,64,175,0.07);
            --radius: 16px;
            --transition: 0.25s cubic-bezier(.4,0,.2,1);
            --font-size-base: 15px;
            --font-size-title: 1.2em;
            --font-size-modal-title: 1.08em;
            --font-size-btn: 1em;
            --padding-card: 18px 12px;
            --padding-modal: 18px 10px 14px 10px;
            --padding-btn: 8px 18px;
            --input-padding: 8px 8px 7px 8px;
            --icon-size: 1.1em;
            --summary-blue: #2563eb;
            --summary-green: #22c55e;
            --summary-orange: #f59e42;
            --summary-purple: #a78bfa;
            --summary-pink: #f472b6;
            --summary-gray: #f1f5f9;
        }
        body.dark {
            --primary: #60a5fa;
            --primary-dark: #2563eb;
            --accent: #fbbf24;
            --success: #22d3ee;
            --danger: #f87171;
            --bg: #18181b;
            --bg-card: #23232a;
            --text: #f3f4f6;
            --text-light: #a1a1aa;
            --border: #27272a;
            --shadow: 0 2px 16px rgba(30,64,175,0.15);
        }
        html, body {
            height: 100%;
        }
        body {
            font-family: 'Inter', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            min-height: 100vh;
            transition: background var(--transition), color var(--transition);
            font-size: var(--font-size-base);
        }
        .dashboard-container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 32px 16px 16px 16px;
            display: flex;
            flex-direction: column;
            gap: 32px;
        }
        .dashboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            position: sticky;
            top: 0;
            background: var(--bg);
            z-index: 10;
            padding-bottom: 8px;
        }
        .dashboard-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5em;
            font-weight: 700;
            letter-spacing: -1px;
        }
        .dashboard-title svg {
            width: 36px;
            height: 36px;
            color: var(--primary);
        }
        .dashboard-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toggle-dark {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5em;
            color: var(--primary);
            transition: color var(--transition);
        }
        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: var(--padding-card);
            transition: background var(--transition), box-shadow var(--transition);
        }
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 32px;
        }
        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            .dashboard-title {
                font-size: 1.15em;
            }
            .card {
                padding: 10px 4px;
            }
        }
        .form-title {
            font-size: var(--font-size-title);
            font-weight: 600;
            margin-bottom: 18px;
            color: var(--primary);
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px 24px;
        }
        @media (max-width: 600px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .form-group-full {
            grid-column: span 2;
        }
        label {
            font-size: 1em;
            color: var(--text-light);
            font-weight: 500;
        }
        .input, select, textarea {
            font-family: inherit;
            font-size: var(--font-size-base);
            padding: var(--input-padding);
            border: none;
            border-bottom: 2px solid var(--border);
            background: transparent;
            color: var(--text);
            border-radius: 0;
            outline: none;
            transition: border-color var(--transition), box-shadow var(--transition);
        }
        .input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 2px 0 0 var(--primary);
        }
        textarea {
            resize: vertical;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: var(--padding-btn);
            border: none;
            border-radius: 999px;
            font-size: var(--font-size-btn);
            font-weight: 600;
            cursor: pointer;
            background: var(--primary);
            color: #fff;
            box-shadow: 0 2px 8px rgba(37,99,235,0.07);
            transition: background var(--transition), transform var(--transition), box-shadow var(--transition);
        }
        .btn svg {
            width: var(--icon-size);
            height: var(--icon-size);
        }
        .btn-secondary {
            background: var(--bg-card);
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        .btn:active {
            transform: scale(0.97);
        }
        .btn:disabled {
            background: var(--border);
            color: var(--text-light);
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        /* Spinner para botones */
        .btn-loading {
            position: relative;
            pointer-events: none;
        }
        
        .btn-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .availability-info {
            font-size: 0.98em;
            margin-top: 2px;
            min-height: 1.5em;
            color: var(--text-light);
        }
        .availability-info.available {
            color: var(--success);
        }
        .availability-info.limited {
            color: var(--accent);
        }
        .availability-info.full {
            color: var(--danger);
        }
        .operating-hours-message {
            grid-column: span 2;
            text-align: center;
            font-size: 0.98em;
            color: var(--danger);
            background: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: var(--radius);
            padding: 10px;
            margin-top: -10px;
            margin-bottom: 10px;
        }
        .reservation-list-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .search-input {
            width: 100%;
            padding: var(--input-padding);
            border: none;
            border-bottom: 2px solid var(--border);
            background: transparent;
            color: var(--text);
            font-size: var(--font-size-base);
            border-radius: 0;
            outline: none;
            transition: border-color var(--transition);
        }
        .search-input:focus {
            border-color: var(--primary);
        }
        .reservation-group {
            margin-bottom: 22px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
            background: #f8fafc;
            border-radius: 10px;
            box-shadow: 0 1px 4px rgba(37,99,235,0.04);
        }
        .reservation-group:last-child {
            border-bottom: none;
        }
        .reservation-group-title {
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 8px;
            font-size: 1.08em;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-top: 8px;
            padding-left: 6px;
        }
        .reservation-item {
            display: flex;
            align-items: center;
            gap: 14px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(37,99,235,0.04);
            padding: 8px 14px;
            margin-bottom: 8px;
            font-size: 0.98em;
            border-left: 4px solid var(--primary);
        }
        .reservation-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1em;
            margin-right: 4px;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(37,99,235,0.10);
        }
        .room-name {
            font-weight: 600;
            color: var(--primary-dark);
            min-width: 120px;
            margin-right: 8px;
        }
        .restaurant-time {
            color: var(--primary);
            min-width: 120px;
            margin-right: 8px;
        }
        .pax-info {
            font-weight: 800;
            color: #dc2626;
            background: #fbeaea;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 0.98em;
            margin-left: auto;
        }
        .reservation-timestamp {
            color: var(--text-light);
            font-size: 0.93em;
            min-width: 90px;
            text-align: right;
            margin-left: 12px;
        }
        @media (max-width: 700px) {
            .reservation-group {
                padding-bottom: 6px;
                margin-bottom: 14px;
            }
            .reservation-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
                padding: 8px 8px;
                font-size: 0.96em;
            }
            .reservation-avatar {
                width: 26px;
                height: 26px;
                font-size: 0.9em;
            }
            .room-name, .restaurant-time {
                min-width: 0;
                margin-right: 0;
            }
            .pax-info {
                margin-left: 0;
                margin-top: 4px;
            }
            .reservation-timestamp {
                margin-left: 0;
                font-size: 0.91em;
            }
        }
        .no-reservations {
            text-align: center;
            color: var(--text-light);
            font-style: italic;
            padding: 18px;
            border: 1px dashed var(--border);
            border-radius: var(--radius);
            margin-top: 18px;
            width: 100%;
            box-sizing: border-box;
        }
        /* Snackbar/Toast */
        .snackbar {
            visibility: hidden;
            min-width: 250px;
            background: var(--primary-dark);
            color: #fff;
            text-align: center;
            border-radius: 12px;
            padding: 16px 20px;
            position: fixed;
            z-index: 2000;
            left: 50%;
            bottom: 30px;
            font-size: 1em;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), bottom 0.4s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .snackbar.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
            transform: translateX(-50%) scale(1);
        }
        /* Live Notification System */
        .live-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.15), 0 0 0 1px rgba(255,255,255,0.1);
            z-index: 3000;
            min-width: 320px;
            max-width: 400px;
            opacity: 0;
            transform: translateX(120%) scale(0.9);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-left: 4px solid var(--success);
            animation: slideInRight 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        body.dark .live-notification {
            box-shadow: 0 12px 40px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.05);
        }
        .live-notification.show {
            opacity: 1;
            transform: translateX(0) scale(1);
        }
        .live-notification.hide {
            opacity: 0;
            transform: translateX(120%) scale(0.9);
        }
        .live-notification-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .live-notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--success), #16a34a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(34,197,94,0.3);
            animation: pulse 2s infinite;
        }
        .live-notification-title {
            font-weight: 700;
            color: var(--text);
            font-size: 1.05em;
            margin: 0;
            flex: 1;
        }
        .live-notification-body {
            color: var(--text-light);
            font-size: 0.95em;
            line-height: 1.5;
            margin-top: 8px;
        }
        .live-notification-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }
        .live-notification-detail-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
        }
        .live-notification-detail-label {
            color: var(--text-light);
            font-weight: 500;
        }
        .live-notification-detail-value {
            color: var(--text);
            font-weight: 600;
        }
        .live-notification-close {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1.2em;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
            opacity: 0.6;
        }
        .live-notification-close:hover {
            opacity: 1;
            background: rgba(0,0,0,0.05);
            color: var(--primary);
        }
        @media (max-width: 600px) {
            .live-notification {
                top: 10px;
                right: 10px;
                left: 10px;
                min-width: auto;
                max-width: none;
                transform: translateY(-120%);
            }
            .live-notification.show {
                transform: translateY(0);
            }
            .live-notification.hide {
                transform: translateY(-120%);
            }
        }
        /* Loading Spinner */
        .spinner-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(37,99,235,0.08);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .spinner {
            border: 6px solid #f3f3f3;
            border-top: 6px solid var(--primary);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* MODERN MODAL STYLES */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(30,41,59,0.5);
            backdrop-filter: blur(8px) saturate(180%);
            -webkit-backdrop-filter: blur(8px) saturate(180%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.3s;
            overflow-y: auto;
            padding: 20px;
        }
        body.dark .modal-overlay {
            background: rgba(0,0,0,0.7);
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            padding: 28px 24px;
            max-width: 400px;
            width: 100%;
            gap: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--bg-card);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
            text-align: center;
            position: relative;
            animation: fadeInScaleUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            max-height: 92vh;
            box-sizing: border-box;
            border: 1px solid rgba(255,255,255,0.1);
        }
        body.dark .modal-content {
            box-shadow: 0 20px 60px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.05);
        }
        .modal-content h3 {
            font-size: 1.25em;
            gap: 10px;
            margin-bottom: 0.75em;
            margin-top: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--primary);
            width: 100%;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
            letter-spacing: -0.5px;
        }
        .modal-content .modal-icon {
            font-size: 1.4em;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        .modal-content p {
            color: var(--text-light);
            font-size: 1em;
            margin: 16px 0 20px 0;
            text-align: center;
            width: 100%;
            line-height: 1.6;
        }
        .modal-content input[type="text"],
        .modal-content input[type="number"],
        .modal-content textarea {
            width: 100%;
            margin: 0 0 18px 0;
            font-size: var(--font-size-base);
            padding: 12px 16px;
            border: 2px solid var(--border);
            background: var(--bg);
            color: var(--text);
            border-radius: 12px;
            outline: none;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-sizing: border-box;
            text-align: left;
            display: block;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        .modal-content input:focus,
        .modal-content textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37,99,235,0.1), 0 4px 12px rgba(0,0,0,0.08);
            background: var(--bg-card);
            transform: translateY(-1px);
        }
        body.dark .modal-content input:focus,
        body.dark .modal-content textarea:focus {
            box-shadow: 0 0 0 4px rgba(96,165,250,0.2), 0 4px 12px rgba(0,0,0,0.3);
        }
        .modal-actions {
            display: flex;
            flex-direction: row;
            justify-content: stretch;
            gap: 12px;
            margin-top: 18px;
            width: 100%;
        }
        .modal-actions .btn, .modal-actions .btn-secondary {
            flex: 1 1 0;
            min-width: 0;
            width: 100%;
            margin: 0;
        }
        .modal-close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(0,0,0,0.05);
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1;
            padding: 6px 10px;
            z-index: 2;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        body.dark .modal-close-btn {
            background: rgba(255,255,255,0.05);
        }
        .modal-close-btn:hover {
            color: var(--primary);
            background: rgba(37,99,235,0.1);
            transform: scale(1.1) rotate(90deg);
        }
        .modal-close-btn:active {
            transform: scale(0.95) rotate(90deg);
        }
        @keyframes fadeInItem {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInScaleUp {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        @media (max-width: 600px) {
            .modal-content {
                padding: 8px 2px 8px 2px;
                max-width: 98vw;
                gap: 0;
            }
            .modal-content h3 {
                font-size: 1em;
            }
            .modal-actions {
                flex-direction: column;
                gap: 8px;
                margin-top: 12px;
            }
        }
        /* Responsive */
        @media (max-width: 700px) {
            .dashboard-container {
                padding: 12px 2px 2px 2px;
            }
            .card {
                padding: 16px 6px;
            }
            .modal-content {
                padding: 16px 6px;
            }
        }
        /* Mejorar el resumen de reservas - Dise√±o Moderno y Minimalista */
        .summary-content {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-top: 0;
            width: 100%;
        }
        .summary-restaurant {
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 0;
            margin-bottom: 12px;
            display: flex;
            flex-direction: column;
            gap: 0;
            font-size: 1em;
            overflow: visible;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
        }
        .summary-restaurant:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transform: translateY(-1px);
        }
        .summary-restaurant:last-child {
            margin-bottom: 0;
        }
        .summary-restaurant h4 {
            color: var(--text);
            margin: 0;
            font-size: 1.1em;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            background: linear-gradient(135deg, rgba(37,99,235,0.05), rgba(37,99,235,0.02));
            border-bottom: 1px solid var(--border);
            letter-spacing: -0.2px;
        }
        body.dark .summary-restaurant h4 {
            background: linear-gradient(135deg, rgba(96,165,250,0.08), rgba(96,165,250,0.03));
        }
        .summary-restaurant h4 span {
            font-size: 0.9em;
            color: var(--primary);
            font-weight: 600;
            background: rgba(37,99,235,0.1);
            padding: 5px 12px;
            border-radius: 16px;
            letter-spacing: 0.2px;
        }
        body.dark .summary-restaurant h4 span {
            background: rgba(96,165,250,0.2);
        }
        /* Estilos espec√≠ficos por restaurante con colores suaves y tem√°ticos */
        .summary-restaurant.restaurant-himitsu {
            border-left: 5px solid #10b981;
            background: linear-gradient(135deg, rgba(16,185,129,0.05), rgba(16,185,129,0.02));
        }
        .summary-restaurant.restaurant-himitsu h4 {
            background: linear-gradient(135deg, rgba(16,185,129,0.12), rgba(16,185,129,0.05));
        }
        .summary-restaurant.restaurant-himitsu h4 span {
            background: rgba(16,185,129,0.2);
            color: #059669;
        }
        .summary-restaurant.restaurant-hibachi {
            border-left: 5px solid #f97316;
            background: linear-gradient(135deg, rgba(249,115,22,0.05), rgba(249,115,22,0.02));
        }
        .summary-restaurant.restaurant-hibachi h4 {
            background: linear-gradient(135deg, rgba(249,115,22,0.12), rgba(249,115,22,0.05));
        }
        .summary-restaurant.restaurant-hibachi h4 span {
            background: rgba(249,115,22,0.2);
            color: #ea580c;
        }
        .summary-restaurant.restaurant-patio {
            border-left: 5px solid #eab308;
            background: linear-gradient(135deg, rgba(234,179,8,0.05), rgba(234,179,8,0.02));
        }
        .summary-restaurant.restaurant-patio h4 {
            background: linear-gradient(135deg, rgba(234,179,8,0.12), rgba(234,179,8,0.05));
        }
        .summary-restaurant.restaurant-patio h4 span {
            background: rgba(234,179,8,0.2);
            color: #ca8a04;
        }
        .summary-restaurant.restaurant-bluewater {
            border-left: 5px solid #3b82f6;
            background: linear-gradient(135deg, rgba(59,130,246,0.05), rgba(59,130,246,0.02));
        }
        .summary-restaurant.restaurant-bluewater h4 {
            background: linear-gradient(135deg, rgba(59,130,246,0.12), rgba(59,130,246,0.05));
        }
        .summary-restaurant.restaurant-bluewater h4 span {
            background: rgba(59,130,246,0.2);
            color: #2563eb;
        }
        .summary-restaurant.restaurant-bordeaux {
            border-left: 5px solid #a855f7;
            background: linear-gradient(135deg, rgba(168,85,247,0.05), rgba(168,85,247,0.02));
        }
        .summary-restaurant.restaurant-bordeaux h4 {
            background: linear-gradient(135deg, rgba(168,85,247,0.12), rgba(168,85,247,0.05));
        }
        .summary-restaurant.restaurant-bordeaux h4 span {
            background: rgba(168,85,247,0.2);
            color: #9333ea;
        }
        .summary-restaurant.restaurant-olio {
            border-left: 5px solid #84cc16;
            background: linear-gradient(135deg, rgba(132,204,22,0.05), rgba(132,204,22,0.02));
        }
        .summary-restaurant.restaurant-olio h4 {
            background: linear-gradient(135deg, rgba(132,204,22,0.12), rgba(132,204,22,0.05));
        }
        .summary-restaurant.restaurant-olio h4 span {
            background: rgba(132,204,22,0.2);
            color: #65a30d;
        }
        /* Modo oscuro para restaurantes */
        body.dark .summary-restaurant.restaurant-himitsu {
            border-left-color: #34d399;
            background: linear-gradient(135deg, rgba(52,211,153,0.12), rgba(52,211,153,0.05));
        }
        body.dark .summary-restaurant.restaurant-himitsu h4 {
            background: linear-gradient(135deg, rgba(52,211,153,0.15), rgba(52,211,153,0.08));
        }
        body.dark .summary-restaurant.restaurant-himitsu h4 span {
            background: rgba(52,211,153,0.25);
            color: #34d399;
        }
        body.dark .summary-restaurant.restaurant-hibachi {
            border-left-color: #fb923c;
            background: linear-gradient(135deg, rgba(251,146,60,0.12), rgba(251,146,60,0.05));
        }
        body.dark .summary-restaurant.restaurant-hibachi h4 {
            background: linear-gradient(135deg, rgba(251,146,60,0.15), rgba(251,146,60,0.08));
        }
        body.dark .summary-restaurant.restaurant-hibachi h4 span {
            background: rgba(251,146,60,0.25);
            color: #fb923c;
        }
        body.dark .summary-restaurant.restaurant-patio {
            border-left-color: #fde047;
            background: linear-gradient(135deg, rgba(253,224,71,0.12), rgba(253,224,71,0.05));
        }
        body.dark .summary-restaurant.restaurant-patio h4 {
            background: linear-gradient(135deg, rgba(253,224,71,0.15), rgba(253,224,71,0.08));
        }
        body.dark .summary-restaurant.restaurant-patio h4 span {
            background: rgba(253,224,71,0.25);
            color: #fde047;
        }
        body.dark .summary-restaurant.restaurant-bluewater {
            border-left-color: #60a5fa;
            background: linear-gradient(135deg, rgba(96,165,250,0.12), rgba(96,165,250,0.05));
        }
        body.dark .summary-restaurant.restaurant-bluewater h4 {
            background: linear-gradient(135deg, rgba(96,165,250,0.15), rgba(96,165,250,0.08));
        }
        body.dark .summary-restaurant.restaurant-bluewater h4 span {
            background: rgba(96,165,250,0.25);
            color: #60a5fa;
        }
        body.dark .summary-restaurant.restaurant-bordeaux {
            border-left-color: #c084fc;
            background: linear-gradient(135deg, rgba(192,132,252,0.12), rgba(192,132,252,0.05));
        }
        body.dark .summary-restaurant.restaurant-bordeaux h4 {
            background: linear-gradient(135deg, rgba(192,132,252,0.15), rgba(192,132,252,0.08));
        }
        body.dark .summary-restaurant.restaurant-bordeaux h4 span {
            background: rgba(192,132,252,0.25);
            color: #c084fc;
        }
        body.dark .summary-restaurant.restaurant-olio {
            border-left-color: #a3e635;
            background: linear-gradient(135deg, rgba(163,230,53,0.12), rgba(163,230,53,0.05));
        }
        body.dark .summary-restaurant.restaurant-olio h4 {
            background: linear-gradient(135deg, rgba(163,230,53,0.15), rgba(163,230,53,0.08));
        }
        body.dark .summary-restaurant.restaurant-olio h4 span {
            background: rgba(163,230,53,0.25);
            color: #a3e635;
        }
        .summary-time-group {
            margin: 0;
            margin-bottom: 0;
            padding: 14px 18px 16px 18px;
            border-top: 1px solid var(--border);
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            display: flex;
            flex-direction: column;
            gap: 12px;
            font-size: 0.98em;
            position: relative;
        }
        .summary-time-group:last-child {
            border-bottom: none;
            padding-bottom: 16px;
        }
        .summary-time {
            font-weight: 600;
            color: var(--text);
            margin: 0 0 10px 0;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.2px;
        }
        .summary-time-badge {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)) !important;
            color: #fff !important;
            border-radius: 6px;
            padding: 5px 12px;
            font-size: 0.92em;
            font-weight: 700;
            margin: 0;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border: none;
            letter-spacing: 0.3px;
            box-shadow: 0 1px 4px rgba(37,99,235,0.25);
            position: relative;
        }
        .summary-time-badge::before {
            content: "üïê";
            font-size: 1em;
            margin-right: 2px;
        }
        /* Colores diferentes para cada hora */
        .summary-time-badge.time-1730 {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;
            box-shadow: 0 1px 4px rgba(139,92,246,0.3) !important;
        }
        .summary-time-badge.time-1800 {
            background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
            box-shadow: 0 1px 4px rgba(59,130,246,0.3) !important;
        }
        .summary-time-badge.time-1830 {
            background: linear-gradient(135deg, #06b6d4, #0891b2) !important;
            box-shadow: 0 1px 4px rgba(6,182,212,0.3) !important;
        }
        .summary-time-badge.time-1845 {
            background: linear-gradient(135deg, #14b8a6, #0d9488) !important;
            box-shadow: 0 1px 4px rgba(20,184,166,0.3) !important;
        }
        .summary-time-badge.time-2000 {
            background: linear-gradient(135deg, #f59e0b, #d97706) !important;
            box-shadow: 0 1px 4px rgba(245,158,11,0.3) !important;
        }
        .summary-time-badge.time-2100 {
            background: linear-gradient(135deg, #ef4444, #dc2626) !important;
            box-shadow: 0 1px 4px rgba(239,68,68,0.3) !important;
        }
        .summary-time-badge.time-2115 {
            background: linear-gradient(135deg, #ec4899, #db2777) !important;
            box-shadow: 0 1px 4px rgba(236,72,153,0.3) !important;
        }
        .summary-time span {
            color: var(--text-light);
            font-weight: 600;
            font-size: 0.92em;
            margin-left: auto;
            background: rgba(34,197,94,0.1);
            padding: 4px 12px;
            border-radius: 5px;
        }
        body.dark .summary-time span {
            background: rgba(34,211,238,0.15);
            color: var(--success);
        }
        .summary-reservation-detail {
            margin-left: 0;
            font-size: 0.94em;
            color: var(--text-light);
            margin-bottom: 0;
            line-height: 1.6;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .summary-reservation-detail strong {
            color: var(--text);
            font-weight: 600;
        }
        .summary-reservation-detail em {
            color: var(--text);
            font-style: normal;
            font-size: 0.93em;
        }
        .summary-reservation-detail span {
            color: var(--primary);
            font-size: 0.92em;
            font-weight: 500;
        }
        .summary-overall-pax {
            text-align: center;
            margin: 18px 0 8px 0;
            font-size: 1.2em;
            font-weight: 700;
            color: var(--text);
            padding: 16px 20px;
            background: linear-gradient(135deg, rgba(34,197,94,0.08), rgba(34,197,94,0.04));
            border-top: 2px solid var(--border);
            border-radius: 0 0 12px 12px;
            letter-spacing: -0.3px;
            flex-shrink: 0;
            position: relative;
        }
        body.dark .summary-overall-pax {
            background: linear-gradient(135deg, rgba(34,211,238,0.12), rgba(34,211,238,0.06));
        }
        .summary-overall-pax::before {
            content: "üìä ";
            margin-right: 8px;
        }
        @media (max-width: 600px) {
            #summaryModal .modal-content {
                max-width: 99vw;
                max-height: 90vh;
                padding: 0;
            }
            #summaryModal .modal-content h3 {
                padding: 16px;
                font-size: 1.1em;
            }
            #summaryContent.summary-content {
                padding: 14px 16px 24px 16px;
                gap: 0;
                max-height: calc(90vh - 60px);
            }
            .summary-restaurant {
                margin-bottom: 12px;
            }
            .summary-restaurant h4 {
                font-size: 1.02em;
                padding: 12px 14px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            .summary-restaurant h4 span {
                font-size: 0.85em;
                padding: 4px 10px;
            }
            .summary-time-group {
                padding: 12px 14px;
                gap: 10px;
                font-size: 0.92em;
            }
            .summary-time {
                font-size: 0.95em;
                flex-wrap: wrap;
                margin-bottom: 8px;
            }
            .summary-time-badge {
                font-size: 0.88em;
                padding: 4px 10px;
            }
            .summary-time span {
                margin-left: 0;
                margin-top: 4px;
                font-size: 0.88em;
                padding: 3px 10px;
            }
            .summary-table {
                min-width: 500px;
                font-size: 0.88em;
            }
            .summary-table th, .summary-table td {
                padding: 8px 12px;
                font-size: 0.88em;
            }
            .summary-table th {
                font-size: 0.82em;
                padding: 10px 12px;
            }
            .summary-table .pax-cell {
                font-size: 0.92em;
            }
            .summary-table .comment-cell {
                max-width: 120px;
                font-size: 0.85em;
            }
            .summary-table .validator-cell {
                font-size: 0.86em;
            }
            .summary-overall-pax {
                font-size: 1.1em;
                padding: 14px 16px;
                margin: 14px 0 8px 0;
            }
        }
        #summaryModal .modal-content {
            max-width: 900px;
            width: 99vw;
            min-width: 0;
            box-sizing: border-box;
            overflow: hidden;
            padding: 0;
            font-size: 1em;
            max-height: 95vh;
            height: auto;
            display: flex;
            flex-direction: column;
        }
        #archiveModal .modal-content {
            max-width: 950px;
            padding: 32px 24px 24px 24px;
        }
        #summaryModal .modal-content h3 {
            padding: 20px 24px 16px 24px;
            margin: 0;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(37,99,235,0.02), rgba(34,197,94,0.02));
            position: relative;
            flex-shrink: 0;
            font-size: 1.2em;
        }
        #summaryModal .modal-content h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 24px;
            right: 24px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            opacity: 0.3;
        }
        #summaryContent.summary-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
            gap: 0;
            padding: 18px 24px 32px 24px;
            min-height: 0;
            max-height: calc(95vh - 80px);
        }
        /* Scrollbar personalizado para el resumen */
        #summaryContent.summary-content {
            scrollbar-width: thin;
            scrollbar-color: var(--border) transparent;
            -webkit-overflow-scrolling: touch;
        }
        #summaryContent.summary-content::-webkit-scrollbar {
            width: 10px;
        }
        #summaryContent.summary-content::-webkit-scrollbar-track {
            background: transparent;
            margin: 4px 0;
        }
        #summaryContent.summary-content::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        #summaryContent.summary-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-light);
            background-clip: padding-box;
        }
        #summaryContent.summary-content::-webkit-scrollbar-thumb:active {
            background: var(--primary);
            background-clip: padding-box;
        }
        /* Asegurar que todos los elementos sean visibles */
        .summary-restaurant:last-of-type {
            margin-bottom: 0;
        }
        .summary-restaurant:last-of-type .summary-overall-pax {
            margin-bottom: 0;
        }
        .summary-table-group {
            margin-bottom: 18px;
        }
        .summary-table-title {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.08em;
            margin: 0 0 4px 0;
            padding: 0;
        }
        .summary-table-time {
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 0.98em;
            margin: 6px 0 2px 0;
            padding: 0;
        }
        .summary-table {
            width: 100%;
            min-width: 600px;
            border-collapse: separate;
            border-spacing: 0;
            background: transparent;
            font-size: 0.95em;
            margin-top: 0;
            margin-bottom: 0;
            border-radius: 8px;
            overflow: visible;
        }
        .summary-table th, .summary-table td {
            padding: 10px 14px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
            line-height: 1.5;
        }
        .summary-table th {
            background: rgba(37,99,235,0.04);
            color: var(--text);
            font-weight: 600;
            font-size: 0.88em;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 1;
            padding: 12px 14px;
        }
        body.dark .summary-table th {
            background: rgba(96,165,250,0.06);
        }
        .summary-table tbody tr {
            transition: background 0.15s;
        }
        .summary-table tbody tr:hover {
            background: rgba(37,99,235,0.02);
        }
        body.dark .summary-table tbody tr:hover {
            background: rgba(96,165,250,0.04);
        }
        .summary-table tbody tr:last-child td {
            border-bottom: none;
        }
        .summary-table td {
            color: var(--text);
            font-size: 0.95em;
        }
        .summary-table .pax-cell {
            color: #ef4444;
            font-weight: 700;
            font-size: 0.98em;
        }
        .summary-table .comment-cell {
            color: var(--text-light);
            font-size: 0.9em;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .summary-table .validator-cell {
            color: var(--primary);
            font-size: 0.92em;
            font-weight: 500;
        }
        .summary-overall-pax {
            text-align: right;
            margin-top: 16px;
            font-size: 1.13em;
            font-weight: 800;
            color: #dc2626;
            padding-top: 10px;
            border-top: 2px solid var(--summary-blue);
        }
        @media (max-width: 900px) {
            #summaryModal .modal-content {
                max-width: 99vw;
                max-height: 93vh;
            }
            #summaryModal .modal-content h3 {
                padding: 18px 20px 14px 20px;
                font-size: 1.15em;
            }
            #summaryContent.summary-content {
                padding: 16px 20px 28px 20px;
                max-height: calc(93vh - 70px);
            }
            .summary-restaurant {
                margin-bottom: 12px;
            }
            .summary-restaurant h4 {
                padding: 12px 16px;
                font-size: 1.05em;
            }
            .summary-restaurant h4 span {
                font-size: 0.88em;
                padding: 4px 10px;
            }
            .summary-time-group {
                padding: 12px 16px;
                font-size: 0.95em;
            }
            .summary-time {
                font-size: 0.98em;
            }
            .summary-time-badge {
                font-size: 0.9em;
                padding: 4px 10px;
            }
            .summary-time span {
                font-size: 0.9em;
                padding: 3px 10px;
            }
            .summary-table {
                font-size: 0.92em;
            }
            .summary-table th, .summary-table td {
                padding: 9px 12px;
                font-size: 0.92em;
            }
            .summary-table th {
                font-size: 0.86em;
                padding: 11px 12px;
            }
            .summary-table .pax-cell {
                font-size: 0.95em;
            }
            .summary-table .comment-cell {
                font-size: 0.88em;
                max-width: 180px;
            }
            .summary-table .validator-cell {
                font-size: 0.9em;
            }
            .summary-overall-pax {
                padding: 14px 18px;
                font-size: 1.15em;
                margin: 16px 0 8px 0;
            }
        }
        #archiveModal .modal-content {
            max-width: 900px;
            width: 99vw;
            min-width: 0;
            box-sizing: border-box;
            overflow: hidden;
            padding: 22px 18px 16px 18px;
            font-size: 1em;
        }
        #archiveListContent.reservation-list {
            max-height: 60vh;
            overflow-y: auto;
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
            padding: 0;
            margin: 0;
        }
        .archive-table {
            width: 100%;
            min-width: 700px;
            border-collapse: collapse;
            background: #f8fafc;
            font-size: 0.97em;
            margin-top: 2px;
        }
        .archive-table th, .archive-table td {
            padding: 6px 8px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            white-space: nowrap;
        }
        .archive-table th {
            background: #2563eb;
            color: #fff;
            font-weight: 700;
            font-size: 0.98em;
        }
        .archive-table tr:nth-child(even) td {
            background: #f3f6fa;
        }
        .archive-table tr:last-child td {
            border-bottom: none;
        }
        .archive-table .pax-cell {
            color: #dc2626;
            font-weight: 800;
        }
        @media (max-width: 700px) {
            #archiveModal .modal-content {
                max-width: 99vw;
                width: 99vw;
                padding: 10px 2vw 10px 2vw;
                font-size: 0.97em;
            }
            .archive-table th, .archive-table td {
                padding: 4px 4px;
                font-size: 0.95em;
            }
            .archive-table {
                min-width: 400px;
            }
        }
        #reservationList.reservation-list {
            max-height: 60vh;
            overflow-y: auto;
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
            padding: 0;
            margin: 0;
        }
        .reservation-table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            background: #f8fafc;
            font-size: 0.97em;
            margin-top: 2px;
        }
        .reservation-table th, .reservation-table td {
            padding: 6px 8px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            white-space: nowrap;
        }
        .reservation-table th {
            background: #2563eb;
            color: #fff;
            font-weight: 700;
            font-size: 0.98em;
        }
        .reservation-table tr:nth-child(even) td {
            background: #f3f6fa;
        }
        .reservation-table tr:last-child td {
            border-bottom: none;
        }
        .reservation-table .pax-cell {
            color: #dc2626;
            font-weight: 800;
        }
        @media (max-width: 700px) {
            .reservation-table th, .reservation-table td {
                padding: 4px 4px;
                font-size: 0.95em;
            }
            .reservation-table {
                min-width: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <div class="dashboard-title">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 21V19C3 17.8954 3.89543 17 5 17H19C20.1046 17 21 17.8954 21 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 17V7C7 5.89543 7.89543 5 9 5H15C16.1046 5 17 5.89543 17 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><rect x="9" y="9" width="6" height="4" rx="1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                Gestor de Reservas
            </div>
            <div class="dashboard-actions">
                <button id="toggleDark" class="toggle-dark" title="Modo oscuro/claro">üåô</button>
                <button id="addReservationBtn" class="btn">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    Nueva Reserva
                </button>
                <button id="viewSummaryBtn" class="btn btn-secondary">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6H20M4 12H20M4 18H11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    Resumen
                </button>
                <button id="viewArchiveBtn" class="btn btn-secondary">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 8V21H3V8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M1 3H23V8H1V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 12H14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    Archivo
                </button>
                <button id="impressionBtn" class="btn btn-secondary">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    Impression
                </button>
            </div>
        </header>
        <main class="main-grid">
            <section class="card reservation-form-section">
                <div class="form-title">Detalles de la Reserva</div>
                <form id="reservationForm" class="form-grid">
                    <div class="form-group">
                        <label for="room">N√∫mero de Habitaci√≥n:</label>
                        <input type="number" id="room" class="input" placeholder="Ej. 1400" min="1000" max="9999" required>
                    </div>
                    <div class="form-group">
                        <label for="guest">Nombre del Huesped:</label>
                        <input type="text" id="guest" class="input" placeholder="Ej. Ismael Duran" required>
                    </div>
                    <div class="form-group">
                        <label for="place">Restaurante:</label>
                        <select id="place" class="input" required>
                            <option value="">Seleccione un restaurante</option>
                            <option value="El Patio">El Patio</option>
                            <option value="Bluewater">Bluewater</option>
                            <option value="Bordeaux">Bordeaux</option>
                            <option value="Himitsu">Himitsu</option>
                            <option value="Hibachi">Hibachi</option>
                            <option value="El Olio">El Olio</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="time">Hora de Reserva:</label>
                        <select id="time" class="input" required>
                            <option value="">Seleccione un restaurante primero</option>
                        </select>
                        <div id="availabilityInfo" class="availability-info"></div>
                    </div>
                    <div class="form-group">
                        <label for="pax">Cantidad de Personas:</label>
                        <input type="number" id="pax" class="input" min="1" value="1" required>
                    </div>
                    <div class="form-group form-group-full">
                        <label for="comment">Comentario:</label>
                        <textarea id="comment" class="input" rows="3" placeholder="Notas especiales, alergias, etc."></textarea>
                    </div>
                    <div id="operatingHoursMessage" class="operating-hours-message" style="display:none;">
                        Las reservas solo se pueden registrar entre las 7:00 AM y las 4:30 PM.
                    </div>
                    <button type="submit" class="btn" id="submitReservationBtn" disabled>
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 12H19M12 5L19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        Registrar Reserva
                    </button>
                </form>
            </section>
            <section class="card reservation-list-section">
                <div class="form-title">Reservas del D√≠a</div>
                <div class="reservation-list-container">
                    <input type="text" id="reservationSearch" class="search-input" placeholder="Buscar por habitaci√≥n o hu√©sped...">
                    <div id="reservationList" class="reservation-list">
                        <p class="no-reservations" id="noReservationsMessage">No hay reservas programadas para hoy.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODERNIZED MODALS -->
    <div id="validationModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" data-modal="validationModal">&times;</button>
            <h3><span class="modal-icon">üõ°Ô∏è</span> Validar Solicitante</h3>
            <p>Por favor, ingrese el nombre de la persona que realiza la reserva.</p>
            <input type="text" id="validatorNameInput" placeholder="Nombre del Solicitante" required>
            <div class="modal-actions">
                <button id="confirmValidationBtn" class="btn">Confirmar</button>
                <button id="cancelValidationBtn" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>
    <div id="summaryModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" data-modal="summaryModal">&times;</button>
            <h3><span class="modal-icon">üìã</span> <span id="summaryTitle">Resumen de Reservas</span></h3>
            <div id="summaryContent" class="summary-content">
                <p>Cargando resumen...</p>
            </div>
            <p id="overallPaxTotal" class="summary-overall-pax"></p>
            <div class="modal-actions">
                <button id="closeSummaryBtn" class="btn btn-secondary">Cerrar</button>
            </div>
        </div>
    </div>
    <div id="archiveModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" data-modal="archiveModal">&times;</button>
            <h3><span class="modal-icon">üóÇÔ∏è</span> <span id="archiveTitle">Archivo de Reservas Hist√≥ricas</span></h3>
            <input type="text" id="archiveSearch" placeholder="Buscar en el archivo por habitaci√≥n, comensal o fecha...">
            <div id="archiveListContent" class="reservation-list">
                <p class="no-reservations" id="noArchivedReservationsMessage">No hay reservas archivadas.</p>
            </div>
            <div class="modal-actions">
                <button id="closeArchiveBtn" class="btn btn-secondary">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Snackbar/Toast -->
    <div id="snackbar" class="snackbar"></div>
    <!-- Live Notification Container -->
    <div id="liveNotificationContainer"></div>
    <!-- Loading Spinner -->
    <div id="spinnerOverlay" class="spinner-overlay" style="display:none;">
        <div class="spinner"></div>
    </div>

    <script type="module">
        // Importar las funciones de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, remove, get, child, update, runTransaction } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // Tu configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyALR-b68phh_u92V3rw9B9Ei7FcexU2xc8",
            authDomain: "proyectos17-98695.firebaseapp.com",
            databaseURL: "https://proyectos17-98695-default-rtdb.firebaseio.com",
            projectId: "proyectos17-98695",
            storageBucket: "proyectos17-98695.appspot.com",
            messagingSenderId: "951673973410",
            appId: "1:951673973410:web:4bc355e825cf86308645fb",
            measurementId: "G-6YK06W16FZ"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app); // Obtener referencia a la Realtime Database

        // Declaraciones globales necesarias para evitar ReferenceError
        let currentReservationData = null;
        let reservationListDiv = null;
        let noReservationsMessage = null;
        let archiveListContent = null;
        let noArchivedReservationsMessage = null;

        // Funci√≥n √∫nica para obtener fecha de hoy
        function getTodayDateString() {
            const today = new Date();
            return today.toISOString().slice(0, 10);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const addReservationBtn = document.getElementById('addReservationBtn');
            const viewSummaryBtn = document.getElementById('viewSummaryBtn');
            const viewArchiveBtn = document.getElementById('viewArchiveBtn');
            const impressionBtn = document.getElementById('impressionBtn');
            const reservationForm = document.getElementById('reservationForm');
            reservationListDiv = document.getElementById('reservationList');
            noReservationsMessage = document.getElementById('noReservationsMessage');
            const validationModal = document.getElementById('validationModal');
            const validatorNameInput = document.getElementById('validatorNameInput');
            const confirmValidationBtn = document.getElementById('confirmValidationBtn');
            const cancelValidationBtn = document.getElementById('cancelValidationBtn');

            const summaryModal = document.getElementById('summaryModal');
            const summaryTitle = document.getElementById('summaryTitle');
            const summaryContent = document.getElementById('summaryContent');
            const overallPaxTotal = document.getElementById('overallPaxTotal');
            const closeSummaryBtn = document.getElementById('closeSummaryBtn');

            const archiveModal = document.getElementById('archiveModal');
            const archiveTitle = document.getElementById('archiveTitle');
            const archiveSearchInput = document.getElementById('archiveSearch');
            archiveListContent = document.getElementById('archiveListContent');
            noArchivedReservationsMessage = document.getElementById('noArchivedReservationsMessage');
            const closeArchiveBtn = document.getElementById('closeArchiveBtn');

            const modalCloseButtons = document.querySelectorAll('.modal-close-btn');

            const roomInput = document.getElementById('room');
            const placeSelect = document.getElementById('place');
            const timeSelect = document.getElementById('time');
            const paxInput = document.getElementById('pax');
            const availabilityInfo = document.getElementById('availabilityInfo');

            const reservationSearchInput = document.getElementById('reservationSearch');
            const submitReservationBtn = document.getElementById('submitReservationBtn');
            const operatingHoursMessage = document.getElementById('operatingHoursMessage');
            const toggleDarkBtn = document.getElementById('toggleDark');

            // Deshabilitar bot√≥n al inicio hasta verificar horario
            if (submitReservationBtn) {
                submitReservationBtn.disabled = true;
            }

            let reservations = []; // Reservas del d√≠a actual, ahora se sincronizar√°n con Firebase
            let archivedReservations = []; // Reservas de d√≠as anteriores, tambi√©n desde Firebase
            let lastAccessDate = localStorage.getItem('lastAccessDate'); // Todav√≠a usado para control de fecha de acceso

            const restaurantTimes = {
                "El Patio": ["18:00", "21:00"],
                "Bluewater": ["18:00", "21:00"],
                "Bordeaux": ["18:00", "21:00"],
                "Himitsu": ["18:00", "21:00"],
                "Hibachi": ["17:30", "18:45", "20:00", "21:15"],
                "El Olio": ["18:30", "21:00"]
            };

            const restaurantPaxLimits = {
                "El Patio": 8,
                "Bluewater": 8,
                "Bordeaux": 6,
                "Himitsu": 8,
                "Hibachi": 10,
                "El Olio": 8
            };

            // --- Funciones de Utilidad de Fecha y Hora ---
            function getFormattedDate(dateString) {
                if (!dateString) return 'Fecha desconocida';
                const date = new Date(dateString + 'T12:00:00'); // A√±adir T12:00:00 para evitar problemas de zona horaria
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('es-ES', options);
            }

            // Nueva funci√≥n para verificar el horario de operaci√≥n
            function checkOperatingHours() {
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();

                const currentTimeInMinutes = currentHour * 60 + currentMinute;

                const startHourInMinutes = 7 * 60; // 7:00 AM
                const endHourInMinutes = 16 * 60 + 30; // 4:30 PM (16:30 PM)

                const isInOperatingHours = currentTimeInMinutes >= startHourInMinutes && currentTimeInMinutes <= endHourInMinutes;

                submitReservationBtn.disabled = !isInOperatingHours;
                if (!isInOperatingHours) {
                    operatingHoursMessage.style.display = 'block';
                } else {
                    operatingHoursMessage.style.display = 'none';
                }
                return isInOperatingHours;
            }

            // Verificar horario inmediatamente al cargar (antes de cargar datos)
            checkOperatingHours();

            // --- L√≥gica de Carga y Archivamiento con Firebase ---
            async function loadAndArchiveReservations() {
                const today = getTodayDateString();
                const dailyReservationsRef = ref(database, `dailyReservations/${today}`);
                const allArchivedReservationsRef = ref(database, 'archivedReservations');

                try {
                    // Cargar reservas archivadas (todas)
                    const archiveSnapshot = await get(allArchivedReservationsRef);
                    if (archiveSnapshot.exists()) {
                        archivedReservations = [];
                        archiveSnapshot.forEach(dateNode => {
                            dateNode.forEach(resNode => {
                                archivedReservations.push({ id: resNode.key, ...resNode.val() });
                            });
                        });
                    } else {
                        archivedReservations = [];
                    }

                    if (lastAccessDate && lastAccessDate !== today) {
                        // Es un nuevo d√≠a, archivar las reservas del d√≠a anterior
                        const previousDayReservationsRef = ref(database, `dailyReservations/${lastAccessDate}`);
                        const previousDaySnapshot = await get(previousDayReservationsRef);

                        if (previousDaySnapshot.exists()) {
                            const previousDayData = previousDaySnapshot.val();
                            const updates = {};
                            for (const key in previousDayData) {
                                const res = previousDayData[key];
                                res.archiveDate = lastAccessDate; // Asegurarse de que tengan la fecha de archivo
                                // Mover a la ruta de archivados bajo su fecha original
                                updates[`archivedReservations/${lastAccessDate}/${key}`] = res;
                            }
                            // Eliminar las reservas del d√≠a anterior despu√©s de moverlas
                            updates[`dailyReservations/${lastAccessDate}`] = null;

                            await update(ref(database), updates); // Realizar la operaci√≥n de actualizaci√≥n en lote
                            console.log(`Reservas del ${lastAccessDate} archivadas y borradas.`);
                        }
                        // Despu√©s de archivar, las reservas del d√≠a actual se reinician (se cargan de Firebase, que estar√° vac√≠o para el nuevo d√≠a)
                        reservations = [];
                        // La carga del d√≠a actual se manejar√° con onValue para actualizaciones en tiempo real
                    }

                    // Actualizar la fecha de √∫ltimo acceso en localStorage
                    localStorage.setItem('lastAccessDate', today);
                    lastAccessDate = today;

                    // Escuchar cambios en las reservas del d√≠a actual en tiempo real
                    onValue(dailyReservationsRef, (snapshot) => {
                        const data = snapshot.val();
                        const currentReservationIds = new Set();
                        reservations = [];
                        
                        if (data) {
                            for (const key in data) {
                                const reservation = { id: key, ...data[key] };
                                reservations.push(reservation);
                                currentReservationIds.add(key);
                                
                                // Detectar nuevas reservas y mostrar notificaci√≥n
                                if (!previousReservationIds.has(key)) {
                                    // Es una nueva reserva (no estaba en el set anterior)
                                    // Mostrar notificaci√≥n solo si no es la primera carga
                                    if (previousReservationIds.size > 0) {
                                        const reservationTimestamp = reservation.timestamp || Date.now();
                                        const now = Date.now();
                                        const timeDiff = now - reservationTimestamp;
                                        
                                        // Verificar si esta reserva fue creada por el usuario actual
                                        // Comparar timestamp con las reservas recientes del usuario
                                        const isUserReservation = userReservationTimestamps.some(ts => {
                                            return Math.abs(ts - reservationTimestamp) < 3000; // 3 segundos de tolerancia
                                        });
                                        
                                        // Mostrar notificaci√≥n solo si:
                                        // 1. La reserva es muy reciente (probablemente de otro usuario)
                                        // 2. No es una reserva del usuario actual
                                        if (timeDiff < 15000 && !isUserReservation) { // 15 segundos
                                            setTimeout(() => {
                                                showLiveNotification(reservation);
                                            }, 800);
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Actualizar el set de IDs anteriores
                        previousReservationIds = currentReservationIds;
                        
                        renderReservations(); // Volver a renderizar cada vez que cambian las reservas
                        updateAvailabilityInfo(); // Actualizar disponibilidad tambi√©n
                    }, (error) => {
                        console.error("Error al escuchar cambios en reservas:", error);
                    });

                } catch (error) {
                    console.error("Error al cargar o archivar reservas:", error);
                    alert("Hubo un error al cargar los datos de las reservas. Por favor, intente de nuevo.");
                }

                checkOperatingHours(); // Verificar horario y deshabilitar/habilitar bot√≥n
            }


            // Llamar a la funci√≥n de carga y archivo al inicio
            loadAndArchiveReservations();

            // Evento para modo oscuro/claro
            toggleDarkBtn.addEventListener('click', () => {
                document.body.classList.toggle('dark');
                const isDark = document.body.classList.contains('dark');
                toggleDarkBtn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
                localStorage.setItem('darkMode', isDark);
            });

            // Cargar preferencia de modo oscuro
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            if (savedDarkMode) {
                document.body.classList.add('dark');
                toggleDarkBtn.textContent = '‚òÄÔ∏è';
            }

            // Evento para mostrar el formulario de agregar reserva
            addReservationBtn.addEventListener('click', () => {
                reservationForm.reset();
                placeSelect.value = "";
                updateTimeOptions(placeSelect.value);
                timeSelect.disabled = true;
                availabilityInfo.textContent = '';
                availabilityInfo.className = 'availability-info';
                roomInput.focus();
                reservationForm.scrollIntoView({ behavior: 'smooth' });
                reservationSearchInput.value = '';
                filterReservations();
                checkOperatingHours();
            });

            // Evento para abrir el popup de resumen
            viewSummaryBtn.addEventListener('click', () => {
                generateReservationsSummary();
                showSummaryModal();
            });

            // Reemplaza el evento de viewArchiveBtn y la carga de archivo por:
            viewArchiveBtn.addEventListener('click', async () => {
                archiveSearchInput.value = '';
                const dailyReservationsRef = ref(database, 'dailyReservations');
                try {
                    const snapshot = await get(dailyReservationsRef);
                    archivedReservations = [];
                    const today = getTodayDateString();
                    if (snapshot.exists()) {
                        snapshot.forEach(dateNode => {
                            const dateKey = dateNode.key;
                            if (dateKey !== today) {
                                dateNode.forEach(resNode => {
                                    archivedReservations.push({
                                        id: resNode.key,
                                        ...resNode.val(),
                                        archiveDate: dateKey // Guardar la fecha de la reserva
                                    });
                                });
                            }
                        });
                    }
                    renderArchivedReservations();
                    showArchiveModal();
                } catch (error) {
                    console.error('Error al cargar el archivo de reservas:', error);
                    alert('No se pudo cargar el archivo de reservas. Por favor, intente de nuevo.');
                }
            });

            // Evento para abrir la p√°gina de Impression
            impressionBtn.addEventListener('click', () => {
                window.location.href = 'impression.html';
            });

            // Evento para cerrar el popup de resumen
            closeSummaryBtn.addEventListener('click', () => {
                hideSummaryModal();
            });

            // Nuevo: Evento para cerrar el popup de archivo
            closeArchiveBtn.addEventListener('click', () => {
                hideArchiveModal();
            });

            // Eventos para cerrar modales al hacer clic en el bot√≥n 'X'
            modalCloseButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const modalId = e.target.dataset.modal;
                    if (modalId === 'validationModal') {
                        hideValidationModal();
                        currentReservationData = null;
                    } else if (modalId === 'summaryModal') {
                        hideSummaryModal();
                    } else if (modalId === 'archiveModal') {
                        hideArchiveModal();
                    }
                });
            });

            // Eventos para cerrar modales al hacer clic fuera
            validationModal.addEventListener('click', (e) => {
                if (e.target === validationModal) {
                    hideValidationModal();
                    currentReservationData = null;
                }
            });

            summaryModal.addEventListener('click', (e) => {
                if (e.target === summaryModal) {
                    hideSummaryModal();
                }
            });

            archiveModal.addEventListener('click', (e) => {
                if (e.target === archiveModal) {
                    hideArchiveModal();
                }
            });

            // Eventos para actualizar el contador de disponibilidad
            placeSelect.addEventListener('change', () => {
                const selectedRestaurant = placeSelect.value;
                updateTimeOptions(selectedRestaurant);
                updateAvailabilityInfo();
            });

            timeSelect.addEventListener('change', () => {
                updateAvailabilityInfo();
            });

            paxInput.addEventListener('input', () => {
                updateAvailabilityInfo();
            });

            // Evento para el buscador de reservas del d√≠a
            reservationSearchInput.addEventListener('input', () => {
                filterReservations();
            });

            // Nuevo: Evento para el buscador de reservas archivadas
            archiveSearchInput.addEventListener('input', () => {
                filterArchivedReservations();
            });

            // Funci√≥n para actualizar las opciones de hora seg√∫n el restaurante seleccionado
            function updateTimeOptions(restaurant) {
                timeSelect.innerHTML = '';
                if (restaurant && restaurantTimes[restaurant]) {
                    timeSelect.disabled = false;
                    const times = restaurantTimes[restaurant];
                    const defaultTimeOption = document.createElement('option');
                    defaultTimeOption.value = "";
                    defaultTimeOption.textContent = "Seleccione una hora";
                    timeSelect.appendChild(defaultTimeOption);

                    times.forEach(time24h => {
                        const option = document.createElement('option');
                        option.value = time24h;
                        option.textContent = convertTo12HourFormat(time24h);
                        timeSelect.appendChild(option);
                    });
                } else {
                    timeSelect.disabled = true;
                    const defaultOption = document.createElement('option');
                    defaultOption.value = "";
                    defaultOption.textContent = "Seleccione un restaurante primero";
                    timeSelect.appendChild(defaultOption);
                }
            }

            // Funci√≥n para calcular y mostrar la disponibilidad
            function updateAvailabilityInfo() {
                const selectedRestaurant = placeSelect.value;
                const selectedTime = timeSelect.value;
                const requestedPax = parseInt(paxInput.value, 10);

                if (!selectedRestaurant || !selectedTime) {
                    availabilityInfo.textContent = 'Seleccione restaurante y hora para ver disponibilidad.';
                    availabilityInfo.className = 'availability-info';
                    timeSelect.setCustomValidity('');
                    return;
                }

                const maxPax = restaurantPaxLimits[selectedRestaurant];
                if (maxPax === undefined) {
                    availabilityInfo.textContent = 'L√≠mite de PAX no definido para este restaurante.';
                    availabilityInfo.className = 'availability-info';
                    return;
                }

                const occupiedPax = reservations
                    .filter(res => res.place === selectedRestaurant && res.time === selectedTime)
                    .reduce((sum, res) => sum + res.pax, 0);

                const remainingPax = maxPax - occupiedPax;

                availabilityInfo.textContent = `Espacios disponibles: ${remainingPax} de ${maxPax}`;

                availabilityInfo.className = 'availability-info';
                if (remainingPax > 0) {
                    if (requestedPax > remainingPax) {
                        availabilityInfo.textContent += ` (Solo quedan ${remainingPax})`;
                        availabilityInfo.classList.add('limited');
                        timeSelect.setCustomValidity('');
                    } else {
                        availabilityInfo.classList.add('available');
                        timeSelect.setCustomValidity('');
                    }
                } else {
                    availabilityInfo.textContent = '¬°No hay espacios disponibles para esta hora!';
                    availabilityInfo.classList.add('full');
                    timeSelect.setCustomValidity('No hay espacios disponibles en este horario.');
                    timeSelect.reportValidity();
                }
            }


            // --- Funciones helper para manejar estado de carga de botones ---
            function setButtonLoading(button, loadingText = 'Procesando...') {
                if (!button) return;
                button.disabled = true;
                button.classList.add('btn-loading');
                const originalHTML = button.innerHTML;
                button.dataset.originalHTML = originalHTML;
                button.innerHTML = `<span class="btn-spinner"></span>${loadingText}`;
            }

            function setButtonNormal(button) {
                if (!button) return;
                button.disabled = false;
                button.classList.remove('btn-loading');
                if (button.dataset.originalHTML) {
                    button.innerHTML = button.dataset.originalHTML;
                    delete button.dataset.originalHTML;
                }
            }

            // Variable para prevenir doble clic
            let isSubmitting = false;

            // Evento para manejar el env√≠o del formulario
            reservationForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const submitBtn = document.getElementById('submitReservationBtn');
                
                // Protecci√≥n contra doble clic - verificar estado de carga y flag
                if (isSubmitting || (submitBtn && submitBtn.disabled)) {
                    return;
                }

                if (!checkOperatingHours()) {
                    showSnackbar('No se pueden registrar reservas fuera del horario de operaci√≥n (7:00 AM - 4:30 PM).', 3000);
                    return;
                }

                const room = document.getElementById('room').value.trim();
                const guest = document.getElementById('guest').value.trim();
                const place = document.getElementById('place').value;
                const time = document.getElementById('time').value;
                const pax = parseInt(document.getElementById('pax').value, 10);
                const comment = document.getElementById('comment').value.trim();

                if (room.length !== 4 || isNaN(room) || parseInt(room, 10) < 1000 || parseInt(room, 10) > 9999) {
                    showSnackbar('Por favor, ingrese un n√∫mero de habitaci√≥n v√°lido de 4 d√≠gitos (ej. 1000-9999).', 3000);
                    roomInput.focus();
                    return;
                }

                if (!guest) {
                    showSnackbar('Por favor, ingrese el nombre del hu√©sped.', 3000);
                    document.getElementById('guest').focus();
                    return;
                }

                if (!time) {
                    showSnackbar('Por favor, seleccione una hora de reserva v√°lida para el restaurante elegido.', 3000);
                    return;
                }

                const maxPax = restaurantPaxLimits[place];
                const occupiedPax = reservations
                    .filter(res => res.place === place && res.time === time)
                    .reduce((sum, res) => sum + res.pax, 0);

                const remainingPax = maxPax - occupiedPax;

                if (pax > remainingPax || remainingPax <= 0) {
                    showSnackbar(`Lo sentimos, solo quedan ${Math.max(0, remainingPax)} espacios disponibles para ${place} a las ${convertTo12HourFormat(time)}. Por favor, ajuste la cantidad de personas.`, 4000);
                    paxInput.focus();
                    return;
                }

                // Marcar como procesando
                isSubmitting = true;
                // Bloquear bot√≥n mientras se procesa
                setButtonLoading(submitBtn, 'Validando...');

                currentReservationData = {
                    room,
                    guest,
                    place,
                    time,
                    pax,
                    comment,
                    timestamp: new Date().getTime(),
                    date: getTodayDateString()
                };

                showValidationModal();
                // Restaurar bot√≥n despu√©s de mostrar el modal (el proceso contin√∫a en el modal)
                setButtonNormal(submitBtn);
                isSubmitting = false;
            });

            // Variable para prevenir doble clic en confirmaci√≥n
            let isConfirming = false;

            // Evento para confirmar la validaci√≥n del nombre
            confirmValidationBtn.addEventListener('click', async () => {
                // Verificar si el bot√≥n ya est√° en estado de carga o si ya se est√° procesando
                if (isConfirming || confirmValidationBtn.disabled || !currentReservationData) {
                    return;
                }
                
                const validatorName = validatorNameInput.value.trim();
                if (!validatorName) {
                    showSnackbar('Por favor, ingrese el nombre de quien solicita la reserva.', 3000);
                    validatorNameInput.focus();
                    return;
                }

                // Marcar como procesando
                isConfirming = true;
                // Bloquear bot√≥n mientras se procesa
                setButtonLoading(confirmValidationBtn, 'Registrando...');
                
                try {
                    currentReservationData.validator = validatorName;
                    await addReservationWithUndo(currentReservationData);
                    hideValidationModal();
                    reservationForm.reset();
                    placeSelect.value = "";
                    updateTimeOptions(placeSelect.value);
                    timeSelect.disabled = true;
                    availabilityInfo.textContent = '';
                    availabilityInfo.className = 'availability-info';
                    currentReservationData = null;
                    checkOperatingHours();
                } catch (error) {
                    // El error ya se maneja en addReservationWithUndo
                    // No hacer nada adicional aqu√≠
                } finally {
                    // Restaurar bot√≥n despu√©s de completar
                    setButtonNormal(confirmValidationBtn);
                    isConfirming = false;
                }
            });

            // Evento para cancelar la validaci√≥n
            cancelValidationBtn.addEventListener('click', () => {
                hideValidationModal();
                currentReservationData = null;
            });

            // Funciones para mostrar/ocultar modales
            function showValidationModal() {
                validationModal.classList.add('active');
                validatorNameInput.value = '';
                validatorNameInput.focus();
            }

            function hideValidationModal() {
                validationModal.classList.remove('active');
            }

            function showSummaryModal() {
                summaryModal.classList.add('active');
                summaryModal.focus();
            }

            function hideSummaryModal() {
                summaryModal.classList.remove('active');
            }

            function showArchiveModal() {
                archiveModal.classList.add('active');
                archiveModal.focus();
            }

            function hideArchiveModal() {
                archiveModal.classList.remove('active');
            }

            // Mejorar accesibilidad: navegaci√≥n por teclado en modales
            [validationModal, summaryModal, archiveModal].forEach(modal => {
                if (modal) {
                    modal.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            if (modal === validationModal) {
                                hideValidationModal();
                                currentReservationData = null;
                            } else if (modal === summaryModal) {
                                hideSummaryModal();
                            } else if (modal === archiveModal) {
                                hideArchiveModal();
                            }
                        }
                    });
                }
            });

            // Funci√≥n helper para sanitizar texto y prevenir XSS
            function sanitizeText(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = String(text);
                return div.innerHTML;
            }

            // Funci√≥n helper para formatear timestamp
            function formatTimeFromTimestamp(ts) {
                if (!ts) return '';
                const d = new Date(ts);
                return d.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            }

            // Funci√≥n principal para renderizar reservas (ahora usa los datos de `reservations` que se actualizan desde Firebase)
            function renderReservations(filteredReservations = reservations) {
                if (!reservationListDiv || !noReservationsMessage) return;
                
                // Agrupar por restaurante y hora
                const grouped = {};
                filteredReservations.forEach(res => {
                    if (!grouped[res.place]) grouped[res.place] = {};
                    if (!grouped[res.place][res.time]) grouped[res.place][res.time] = [];
                    grouped[res.place][res.time].push(res);
                });
                reservationListDiv.innerHTML = '';
                const places = Object.keys(grouped).sort();
                if (filteredReservations.length === 0) {
                    noReservationsMessage.textContent = reservations.length === 0 ?
                        'No hay reservas programadas para hoy.' :
                        'No se encontraron reservas con los criterios de b√∫squeda.';
                    noReservationsMessage.style.display = 'block';
                } else {
                    noReservationsMessage.style.display = 'none';
                    places.forEach(place => {
                        const times = Object.keys(grouped[place]).sort();
                        const restInfo = getRestaurantInfo(place);
                        times.forEach(time => {
                            const groupDiv = document.createElement('div');
                            groupDiv.className = 'reservation-group';
                            const groupTitle = document.createElement('div');
                            groupTitle.className = 'reservation-group-title';
                            const emoji = document.createElement('span');
                            emoji.textContent = restInfo.emoji;
                            emoji.style.fontSize = '1.1em';
                            emoji.style.marginRight = '6px';
                            groupTitle.appendChild(emoji);
                            const timeEmoji = document.createElement('span');
                            timeEmoji.textContent = 'üïê';
                            timeEmoji.style.fontSize = '0.9em';
                            timeEmoji.style.marginRight = '4px';
                            groupTitle.appendChild(timeEmoji);
                            groupTitle.appendChild(document.createTextNode(` ${sanitizeText(restInfo.name)} - ${convertTo12HourFormat(time)}`));
                            groupDiv.appendChild(groupTitle);
                            // Ordenar por hora de ingreso (timestamp ascendente)
                            grouped[place][time].sort((a, b) => {
                                if (a.timestamp && b.timestamp) return a.timestamp - b.timestamp;
                                if (a.timestamp) return -1;
                                if (b.timestamp) return 1;
                                return 0;
                            });
                            grouped[place][time].forEach(res => {
                                const reservationItem = document.createElement('div');
                                reservationItem.classList.add('reservation-item');
                                
                                const initials = String(res.guest || '').split(' ').map(w => w[0] || '').join('').slice(0,2).toUpperCase();
                                
                                const avatar = document.createElement('span');
                                avatar.className = 'reservation-avatar';
                                avatar.textContent = initials;
                                
                                const roomName = document.createElement('span');
                                roomName.className = 'room-name';
                                roomName.textContent = `${sanitizeText(res.room)} - ${sanitizeText(res.guest)}`;
                                
                                const restaurantTime = document.createElement('span');
                                restaurantTime.className = 'restaurant-time';
                                restaurantTime.textContent = `${sanitizeText(res.place)} - ${convertTo12HourFormat(res.time)}`;
                                
                                const paxInfo = document.createElement('span');
                                paxInfo.className = 'pax-info';
                                paxInfo.textContent = `${sanitizeText(res.pax)} PAX`;
                                
                                const timestamp = document.createElement('span');
                                timestamp.className = 'reservation-timestamp';
                                timestamp.textContent = `üïí ${formatTimeFromTimestamp(res.timestamp)}`;
                                
                                reservationItem.appendChild(avatar);
                                reservationItem.appendChild(roomName);
                                reservationItem.appendChild(restaurantTime);
                                reservationItem.appendChild(paxInfo);
                                reservationItem.appendChild(timestamp);
                                
                                groupDiv.appendChild(reservationItem);
                            });
                            reservationListDiv.appendChild(groupDiv);
                        });
                    });
                }
            }

            // Funci√≥n para renderizar reservas archivadas (ahora usa los datos de `archivedReservations` que se actualizan desde Firebase)
            function renderArchivedReservations(filteredArchived = archivedReservations) {
                if (!archiveListContent || !noArchivedReservationsMessage) return;
                
                // Agrupar por fecha, restaurante y hora
                const rows = [];
                filteredArchived.forEach(res => {
                    rows.push({
                        date: res.archiveDate || '',
                        restaurant: res.place || '',
                        time: res.time || '',
                        room: res.room || '',
                        guest: res.guest || '',
                        pax: res.pax || '',
                        comment: res.comment || '',
                        validator: res.validator || ''
                    });
                });
                // Ordenar por fecha descendente, restaurante, hora
                rows.sort((a, b) => {
                    const dateComp = new Date(b.date) - new Date(a.date);
                    if (dateComp !== 0) return dateComp;
                    const restComp = a.restaurant.localeCompare(b.restaurant);
                    if (restComp !== 0) return restComp;
                    const timeComp = a.time.localeCompare(b.time);
                    if (timeComp !== 0) return timeComp;
                    return parseInt(a.room) - parseInt(b.room);
                });
                archiveListContent.innerHTML = '';
                if (rows.length === 0) {
                    noArchivedReservationsMessage.textContent = archivedReservations.length === 0 ?
                        'No hay reservas archivadas.' :
                        'No se encontraron reservas archivadas con los criterios de b√∫squeda.';
                    noArchivedReservationsMessage.style.display = 'block';
                } else {
                    noArchivedReservationsMessage.style.display = 'none';
                    const table = document.createElement('table');
                    table.className = 'archive-table';
                    const thead = document.createElement('thead');
                    const headerRow = document.createElement('tr');
                    ['Fecha', 'Restaurante', 'Hora', 'Hab.', 'Hu√©sped', 'PAX', 'Comentario', 'Solicitante'].forEach(header => {
                        const th = document.createElement('th');
                        th.textContent = header;
                        headerRow.appendChild(th);
                    });
                    thead.appendChild(headerRow);
                    table.appendChild(thead);
                    const tbody = document.createElement('tbody');
                    rows.forEach(row => {
                        const tr = document.createElement('tr');
                        [row.date, row.restaurant, row.time, row.room, row.guest, row.pax, row.comment, row.validator].forEach((cell, index) => {
                            const td = document.createElement('td');
                            td.textContent = cell || '';
                            if (index === 5) td.className = 'pax-cell';
                            tr.appendChild(td);
                        });
                        tbody.appendChild(tr);
                    });
                    table.appendChild(tbody);
                    archiveListContent.appendChild(table);
                }
            }

            // Funci√≥n para filtrar reservas del d√≠a
            function filterReservations() {
                const searchTerm = reservationSearchInput.value.toLowerCase().trim();

                if (!searchTerm) {
                    renderReservations(reservations);
                    return;
                }

                const filtered = reservations.filter(res => {
                    const roomMatches = String(res.room).includes(searchTerm);
                    const guestMatches = res.guest.toLowerCase().includes(searchTerm);
                    const restaurantMatches = res.place.toLowerCase().includes(searchTerm);
                    const timeMatches = convertTo12HourFormat(res.time).toLowerCase().includes(searchTerm);
                    return roomMatches || guestMatches || restaurantMatches || timeMatches;
                });

                renderReservations(filtered);
            }

            // Nueva funci√≥n para filtrar reservas archivadas
            function filterArchivedReservations() {
                const searchTerm = archiveSearchInput.value.toLowerCase().trim();

                if (!searchTerm) {
                    renderArchivedReservations(archivedReservations);
                    return;
                }

                const filtered = archivedReservations.filter(res => {
                    const roomMatches = String(res.room).includes(searchTerm);
                    const guestMatches = res.guest.toLowerCase().includes(searchTerm);
                    const restaurantMatches = res.place.toLowerCase().includes(searchTerm);
                    const timeMatches = convertTo12HourFormat(res.time).toLowerCase().includes(searchTerm);
                    const dateMatches = getFormattedDate(res.archiveDate).toLowerCase().includes(searchTerm) || res.archiveDate.includes(searchTerm);
                    return roomMatches || guestMatches || restaurantMatches || timeMatches || dateMatches;
                });

                renderArchivedReservations(filtered);
            }


            // Las funciones saveReservations y saveArchivedReservations ya no son necesarias directamente
            // porque las operaciones de Firebase (push, set) se encargan de la persistencia.
            // Las variables `reservations` y `archivedReservations` se actualizan mediante `onValue` de Firebase.

            function convertTo12HourFormat(time24h) {
                const [hours, minutes] = time24h.split(':');
                const hour = parseInt(hours, 10);
                const ampm = hour >= 12 ? 'PM' : 'AM';
                const displayHour = hour % 12 || 12;
                return `${displayHour}:${minutes} ${ampm}`;
            }

            function getTodayDateFormatted() {
                const today = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                return today.toLocaleDateString('es-ES', options);
            }

            // Funci√≥n para generar y mostrar el resumen de reservas en formato de lista/tabla
            // Funci√≥n helper para obtener emoji y clase CSS de restaurante
            function getRestaurantInfo(restaurantName) {
                const name = restaurantName.toLowerCase();
                if (name.includes('himitsu')) {
                    return { emoji: 'üç±', class: 'restaurant-himitsu', name: 'Himitsu' };
                } else if (name.includes('hibachi')) {
                    return { emoji: 'üî•', class: 'restaurant-hibachi', name: 'Hibachi' };
                } else if (name.includes('patio')) {
                    return { emoji: 'üåÆ', class: 'restaurant-patio', name: 'El Patio' };
                } else if (name.includes('bluewater')) {
                    return { emoji: 'ü•©', class: 'restaurant-bluewater', name: 'Bluewater' };
                } else if (name.includes('bordeaux')) {
                    return { emoji: 'üç∑', class: 'restaurant-bordeaux', name: 'Bordeaux' };
                } else if (name.includes('olio')) {
                    return { emoji: 'üçù', class: 'restaurant-olio', name: 'El Olio' };
                }
                return { emoji: 'üçΩÔ∏è', class: '', name: restaurantName };
            }

            // Funci√≥n helper para obtener clase CSS seg√∫n la hora
            function getTimeClass(time24h) {
                const timeMap = {
                    '17:30': 'time-1730',
                    '18:00': 'time-1800',
                    '18:30': 'time-1830',
                    '18:45': 'time-1845',
                    '20:00': 'time-2000',
                    '21:00': 'time-2100',
                    '21:15': 'time-2115'
                };
                return timeMap[time24h] || 'time-1800'; // Default a 18:00 si no coincide
            }

            function generateReservationsSummary() {
                const groupedReservations = {};
                let totalOverallPax = 0;
                reservations.forEach(res => {
                    const restaurant = res.place;
                    const time = res.time;
                    const pax = res.pax;
                    if (!groupedReservations[restaurant]) groupedReservations[restaurant] = { totalRestaurantPax: 0, times: {} };
                    if (!groupedReservations[restaurant].times[time]) groupedReservations[restaurant].times[time] = [];
                    groupedReservations[restaurant].totalRestaurantPax += pax;
                    groupedReservations[restaurant].times[time].push(res);
                    totalOverallPax += pax;
                });
                let summaryHtml = '';
                const sortedRestaurants = Object.keys(groupedReservations).sort();
                if (sortedRestaurants.length === 0) {
                    summaryHtml = `
                        <div style="text-align: center; padding: 60px 20px; color: var(--text-light);">
                            <div style="font-size: 3em; margin-bottom: 16px; opacity: 0.5;">üìã</div>
                            <p style="font-size: 1.1em; font-weight: 500; margin: 0; color: var(--text-light);">No hay reservas registradas para hoy</p>
                            <p style="font-size: 0.9em; margin-top: 8px; color: var(--text-light); opacity: 0.7;">Las reservas aparecer√°n aqu√≠ cuando se agreguen</p>
                        </div>
                    `;
                } else {
                    sortedRestaurants.forEach(restaurant => {
                        const restaurantData = groupedReservations[restaurant];
                        const restInfo = getRestaurantInfo(restaurant);
                        summaryHtml += `<div class="summary-restaurant ${restInfo.class}">
                            <h4><span style="font-size: 1.2em; margin-right: 8px;">${restInfo.emoji}</span>${restInfo.name} <span>(Total PAX: ${restaurantData.totalRestaurantPax})</span></h4>`;
                        const sortedTimes = Object.keys(restaurantData.times).sort();
                        sortedTimes.forEach(time24h => {
                            const timeData = restaurantData.times[time24h];
                            const timeClass = getTimeClass(time24h);
                            summaryHtml += `<div class="summary-time-group">
                                <div class="summary-time"><span class="summary-time-badge ${timeClass}">${convertTo12HourFormat(time24h)}</span>: <span>${timeData.reduce((sum, r) => sum + r.pax, 0)} PAX</span></div>
                                <table class="summary-table">
                                    <thead>
                                        <tr>
                                            <th>Hab.</th>
                                            <th>Hu√©sped</th>
                                            <th>PAX</th>
                                            <th>Comentario</th>
                                            <th>Solicitante</th>
                                        </tr>
                                    </thead>
                                    <tbody>`;
                            timeData.sort((a, b) => parseInt(a.room) - parseInt(b.room));
                            timeData.forEach(detail => {
                                summaryHtml += `<tr>
                                    <td>${detail.room}</td>
                                    <td>${detail.guest}</td>
                                    <td class="pax-cell">${detail.pax}</td>
                                    <td class="comment-cell">${detail.comment ? detail.comment : ''}</td>
                                    <td class="validator-cell">${detail.validator ? detail.validator : ''}</td>
                                </tr>`;
                            });
                            summaryHtml += `</tbody></table></div>`;
                        });
                        summaryHtml += `</div>`;
                    });
                }
                summaryTitle.textContent = `Resumen de Reservas para ${getTodayDateFormatted()}`;
                summaryContent.innerHTML = summaryHtml;
                overallPaxTotal.textContent = `PAX Total del D√≠a: ${totalOverallPax}`;
            }

            // Asegurarse de que el campo de hora est√© deshabilitado al inicio y el contador limpio
            timeSelect.disabled = true;
            availabilityInfo.textContent = '';

            // Llamar checkOperatingHours() cada minuto para actualizar el estado del bot√≥n
            setInterval(checkOperatingHours, 60 * 1000); // Cada minuto
        });

        // --- NUEVAS MEJORAS UI/UX ---
        // Snackbar/Toast
        function showSnackbar(message, duration = 3000) {
            const snackbar = document.getElementById('snackbar');
            snackbar.textContent = message;
            snackbar.className = 'snackbar show';
            setTimeout(() => {
                snackbar.className = 'snackbar';
            }, duration);
        }

        // Funciones helper globales para notificaciones
        function sanitizeTextGlobal(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = String(text);
            return div.innerHTML;
        }

        function convertTo12HourFormatGlobal(time24h) {
            if (!time24h) return '';
            const [hours, minutes] = time24h.split(':');
            const hour = parseInt(hours, 10);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        // Sistema de Notificaciones en Vivo
        let previousReservationIds = new Set();
        let notificationCounter = 0;
        let userReservationTimestamps = []; // Track del usuario actual para evitar notificaciones propias

        function showLiveNotification(reservation) {
            const container = document.getElementById('liveNotificationContainer');
            if (!container) return;

            const notificationId = `live-notif-${++notificationCounter}`;
            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = 'live-notification';
            
            const restaurant = reservation.place || 'Restaurante';
            const time = reservation.time ? convertTo12HourFormatGlobal(reservation.time) : '';
            const room = reservation.room || '';
            const pax = reservation.pax || 0;
            const guest = reservation.guest || 'Hu√©sped';

            notification.innerHTML = `
                <button class="live-notification-close" onclick="this.closest('.live-notification').classList.add('hide'); setTimeout(() => this.closest('.live-notification').remove(), 400)">√ó</button>
                <div class="live-notification-header">
                    <div class="live-notification-icon">üéâ</div>
                    <h4 class="live-notification-title">Nueva Reserva Agregada</h4>
                </div>
                <div class="live-notification-body">
                    Se agreg√≥ una nueva reserva para el restaurante <strong>${sanitizeTextGlobal(restaurant)}</strong>
                </div>
                <div class="live-notification-details">
                    <div class="live-notification-detail-row">
                        <span class="live-notification-detail-label">Hu√©sped:</span>
                        <span class="live-notification-detail-value">${sanitizeTextGlobal(guest)}</span>
                    </div>
                    <div class="live-notification-detail-row">
                        <span class="live-notification-detail-label">Habitaci√≥n:</span>
                        <span class="live-notification-detail-value">${sanitizeTextGlobal(room)}</span>
                    </div>
                    <div class="live-notification-detail-row">
                        <span class="live-notification-detail-label">Hora:</span>
                        <span class="live-notification-detail-value">${sanitizeTextGlobal(time)}</span>
                    </div>
                    <div class="live-notification-detail-row">
                        <span class="live-notification-detail-label">Personas:</span>
                        <span class="live-notification-detail-value">${sanitizeTextGlobal(pax)} PAX</span>
                    </div>
                </div>
            `;

            container.appendChild(notification);

            // Mostrar notificaci√≥n con animaci√≥n
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            // Ocultar y eliminar despu√©s de 6 segundos
            setTimeout(() => {
                notification.classList.remove('show');
                notification.classList.add('hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 400);
            }, 6000);
        }
        // Loading Spinner
        function showSpinner() {
            document.getElementById('spinnerOverlay').style.display = 'flex';
        }
        function hideSpinner() {
            document.getElementById('spinnerOverlay').style.display = 'none';
        }
        // --- Mejorar accesibilidad y enfoque autom√°tico ---
        function focusFirstInput(form) {
            const first = form.querySelector('input, select, textarea');
            if (first) first.focus();
        }
        // --- Confirmaci√≥n visual y deshacer ---
        let lastReservationUndo = null;
        const restaurantPaxLimits = {
            "El Patio": 8,
            "Bluewater": 8,
            "Bordeaux": 6,
            "Himitsu": 8,
            "Hibachi": 10,
            "El Olio": 8
        };

        async function addReservationWithUndo(data) {
            const today = getTodayDateString();
            const maxPax = restaurantPaxLimits[data.place];
            if (!maxPax) {
                throw new Error('Restaurante no v√°lido');
            }

            // Generar un ID √∫nico para la nueva reserva ANTES de la transacci√≥n
            const reservationId = 'res_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Usar transacci√≥n para proteger contra race conditions (FIFO)
            // La transacci√≥n verifica disponibilidad y agrega la reserva at√≥micamente
            const dailyReservationsRef = ref(database, `dailyReservations/${today}`);
            
            try {
                const result = await runTransaction(dailyReservationsRef, (currentReservations) => {
                    // Si no hay reservas actuales, inicializar objeto vac√≠o
                    if (!currentReservations) {
                        currentReservations = {};
                    }

                    // Calcular PAX ocupado para el restaurante y hora espec√≠ficos
                    let occupiedPax = 0;
                    Object.values(currentReservations).forEach(res => {
                        if (res && res.place === data.place && res.time === data.time) {
                            occupiedPax += (res.pax || 0);
                        }
                    });
                    
                    const remainingPax = maxPax - occupiedPax;
                    
                    // Verificar si hay espacio disponible (FIFO: primera reserva que llega tiene prioridad)
                    if (remainingPax < data.pax) {
                        // Abortar transacci√≥n: no hay espacio suficiente
                        // Retornar null aborta la transacci√≥n sin error
                        return null;
                    }
                    
                    // Agregar la nueva reserva con el ID generado
                    currentReservations[reservationId] = data;
                    
                    // Retornar el objeto actualizado (la transacci√≥n se ejecutar√°)
                    return currentReservations;
                });

                // Verificar si la transacci√≥n fue abortada (retorn√≥ null)
                if (!result || !result.committed || !result.snapshot.exists()) {
                    // Obtener la disponibilidad actual para mostrar mensaje de error
                    const snapshot = await get(dailyReservationsRef);
                    let currentOccupiedPax = 0;
                    if (snapshot.exists()) {
                        const reservations = snapshot.val();
                        Object.values(reservations).forEach(res => {
                            if (res && res.place === data.place && res.time === data.time) {
                                currentOccupiedPax += (res.pax || 0);
                            }
                        });
                    }
                    const remainingPax = maxPax - currentOccupiedPax;
                    throw new Error(`INSUFFICIENT_SPACE: Solo quedan ${remainingPax} espacios disponibles. Otra persona reserv√≥ al mismo tiempo.`);
                }

                // Si la transacci√≥n fue exitosa, guardar info para undo
                lastReservationUndo = { 
                    id: reservationId, 
                    data, 
                    ref: dailyReservationsRef,
                    today 
                };
                
                // Rastrear el timestamp de esta reserva para evitar notificaciones propias
                const reservationTimestamp = data.timestamp || Date.now();
                userReservationTimestamps.push(reservationTimestamp);
                // Limpiar timestamps antiguos (m√°s de 30 segundos)
                userReservationTimestamps = userReservationTimestamps.filter(ts => {
                    return Date.now() - ts < 30000;
                });
                
                showSnackbar('Reserva registrada correctamente.', 4000);
                // Mostrar bot√≥n de deshacer
                showUndoSnackbar();
            } catch (error) {
                console.error("Error al registrar reserva:", error);
                if (error && error.message && error.message.includes('INSUFFICIENT_SPACE')) {
                    const errorMsg = error.message.replace('INSUFFICIENT_SPACE: ', '');
                    showSnackbar(errorMsg, 5000);
                } else {
                    showSnackbar('Error al registrar la reserva. Por favor, intente de nuevo.', 4000);
                }
                throw error;
            }
        }
        function showUndoSnackbar() {
            const snackbar = document.getElementById('snackbar');
            snackbar.innerHTML = 'Reserva registrada. <button id="undoBtn" style="margin-left:12px;padding:4px 12px;border-radius:4px;border:none;background:#FFC107;color:#333;cursor:pointer;font-weight:600;">Deshacer</button>';
            snackbar.className = 'snackbar show';
            
            const undoBtn = document.getElementById('undoBtn');
            if (undoBtn) {
                undoBtn.onclick = async () => {
                    if (lastReservationUndo) {
                        showSpinner();
                        try {
                            // Usar la referencia correcta para eliminar la reserva
                            const reservationToDeleteRef = ref(database, `dailyReservations/${lastReservationUndo.today}/${lastReservationUndo.id}`);
                            await remove(reservationToDeleteRef);
                            showSnackbar('Reserva eliminada correctamente.', 3000);
                            lastReservationUndo = null;
                            snackbar.className = 'snackbar';
                        } catch (error) {
                            console.error('Error al deshacer:', error);
                            showSnackbar('No se pudo deshacer la reserva.', 3000);
                        } finally {
                            hideSpinner();
                        }
                    }
                };
            }
            setTimeout(() => {
                snackbar.className = 'snackbar';
            }, 6000);
        }
        // --- Las funciones showModal est√°n definidas dentro de DOMContentLoaded ---
    </script>
</body>
</html>
actualizado
